/*! signature-signing.js - 0.0.1 - 2014-10-17 - scottmotte */
!function(a){var b=function(){return this.multiplier=null,this.fabrics=[],this.json={signings:[]},this.script=this.CurrentlyExecutedScript(),this.signature_signing_url=this.script.getAttribute("data-signature-signing-url"),this.signature_element_width=232,this.signature_element_height=104,this.font_size=20,this.font_family="Helvetica",this.jafja=void 0,this};b.prototype.init=function(){null===this.multiplier&&console.error("Multipler must be set."),null===fabric&&console.error("Fabric library should be loaded."),this.fabrics.length<1&&console.error("Fabrics must be set."),this._getSigning()},b.prototype._getSigning=function(){var a=this;a._drawCss(),a.Get(a.signature_signing_url,function(b){return a.json=b,a._drawSignatureElements(),a._drawTextElements(),!0})},b.prototype._drawSignatureElements=function(){if(this.json.signings[0].signature_elements)for(var a=0;a<this.json.signings[0].signature_elements.length;a++){var b=this.json.signings[0].signature_elements[a];this.drawSignatureElement(b)}},b.prototype.drawSignatureElement=function(a,b){var c=this,d=new Image;d.src=a.url,d.onload=function(){var e=new fabric.Image(d,{honest_left:parseFloat(a.x),honest_top:parseFloat(a.y),honest_height:c.signature_element_height,honest_width:c.signature_element_width,hasControls:!1,originX:"left",originY:"top",signature_element_id:a.id});c._resizeAndPositionFabricObject(c,e);var f=a.page_number-1,g=c.fabrics[f];return g.add(e).renderAll(),"function"==typeof b?b(e):void 0}},b.prototype._drawTextElements=function(){if(this.json.signings[0].text_elements)for(var a=0;a<this.json.signings[0].text_elements.length;a++){var b=this.json.signings[0].text_elements[a];this.drawTextElement(b)}},b.prototype.drawTextElement=function(a,b){var c=this,d=new fabric.Text(a.content,{honest_left:parseFloat(a.x),honest_top:parseFloat(a.y),hasControls:!1,originX:"left",text_element_id:a.id,fontFamily:c.font_family});c._resizeAndPositionFabricObject(c,d);var e=a.page_number-1,f=c.fabrics[e];return f.add(d).renderAll(),"function"==typeof b?b(d):void 0},b.prototype.removeSelectedObject=function(a){a&&a.preventDefault();for(var b=this,c=0;c<b.fabrics.length;c++){var d=b.fabrics[c]._activeObject;if(d){b.fabrics[c].remove(d),console.log(d);var e,f;d.signature_element_id&&(e=d.signature_element_id,f="signature_element"),d.text_element_id&&(e=d.text_element_id,f="text_element"),b.jafja.trigger("signature_signing.object.removed",{id:e,type:f})}}},b.prototype._resizeAndPositionFabricObject=function(a,b){var c=b.honest_left*a.multiplier,d=b.honest_top*a.multiplier,e=b.honest_height*a.multiplier,f=b.honest_width*a.multiplier,g=a.font_size*a.multiplier;b.set(b.text?{left:c,top:d,fontSize:g}:{left:c,top:d,height:e,width:f}),b.setCoords()},b.prototype.Get=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.send()},b.prototype.CurrentlyExecutedScript=function(){var a;if(document){var b=document.getElementsByTagName("script");a=b[b.length-1]}return a},a.SignatureSigning=b}(this);var signature_signing=new SignatureSigning;!function(a){a.prototype._drawCss=function(){this.css='@charset "utf-8";';var a=document.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=this.css:a.appendChild(document.createTextNode(this.css)),document.body.appendChild(a)}}(SignatureSigning);