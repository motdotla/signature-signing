/*! signature-signing.js - 0.0.1 - 2014-10-07 - scottmotte */
var MicroEvent=function(){};MicroEvent.prototype={bind:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},unbind:function(a,b){this._events=this._events||{},a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(a){for(var b=["bind","unbind","trigger"],c=0;c<b.length;c++)"function"==typeof a?a.prototype[b[c]]=MicroEvent.prototype[b[c]]:a[b[c]]=MicroEvent.prototype[b[c]]},"undefined"!=typeof module&&"exports"in module&&(module.exports=MicroEvent),function(a){var b=function(){return this.multiplier=null,this.fabrics=[],this.json={signings:[]},this.script=this.CurrentlyExecutedScript(),this.signature_signing_url=this.script.getAttribute("data-signature-signing-url"),this.signature_element_width=232,this.signature_element_height=104,this};b.prototype.init=function(){null===this.multiplier&&console.error("Multipler must be set."),null===fabric&&console.error("Fabric library should be loaded."),this.fabrics.length<1&&console.error("Fabrics must be set."),this._getSigning()},b.prototype._getSigning=function(){var a=this;a._drawCss(),a.Get(a.signature_signing_url,function(b){return a.json=b,a._drawSignatureElements(),!0})},b.prototype._drawSignatureElements=function(){for(var a=0;a<this.json.signings[0].signature_elements.length;a++){var b=this.json.signings[0].signature_elements[a];this._drawSignatureElement(b)}},b.prototype._drawSignatureElement=function(a,b){var c=this,d=new Image;d.src=a.url,d.onload=function(){var e=new fabric.Image(d,{honest_left:parseFloat(a.x),honest_top:parseFloat(a.y),honest_height:c.signature_element_height,honest_width:c.signature_element_width,hasControls:!1,originX:"left",originY:"top",signature_element_id:a.id});c._resizeAndPositionFabricObject(c,e);var f=a.page_number-1,g=c.fabrics[f];return g.add(e).renderAll(),"function"==typeof b?b(e):void 0}},b.prototype._resizeAndPositionFabricObject=function(a,b){var c=b.honest_left*a.multiplier,d=b.honest_top*a.multiplier,e=b.honest_height*a.multiplier,f=b.honest_width*a.multiplier;b.set({left:c,top:d,height:e,width:f}),b.setCoords()},b.prototype.Get=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.send()},b.prototype.CurrentlyExecutedScript=function(){var a;if(document){var b=document.getElementsByTagName("script");a=b[b.length-1]}return a},a.SignatureSigning=b}(this),MicroEvent.mixin(SignatureSigning);var signature_signing=new SignatureSigning;!function(a){a.prototype._drawCss=function(){this.css='@charset "utf-8";';var a=document.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=this.css:a.appendChild(document.createTextNode(this.css)),document.body.appendChild(a)}}(SignatureSigning);